#!/bin/bash

# Cowrie Installation and Running Script

# Update system
echo "Updating system..."
sudo apt update -y
sudo apt install iptables -y

# Install dependencies
echo "Installing dependencies..."
sudo apt-get install git python3-virtualenv libssl-dev libffi-dev build-essential libpython3-dev python3-minimal authbind virtualenv

# Create user for Cowrie
sudo adduser --disabled-password --gecos "" cowrie
sudo -u cowrie bin/bash sh -c 'git clone https://github.com/cowrie/cowrie /home/cowrie/cowrie'
cd /home/cowrie/cowrie
python -m venv cowrie-env

sudo -u cowrie bin/bash sh -c 'source /home/cowrie/cowrie/cowrie-env/bin/activate && python -m pip install --upgrade pip'
sudo -u cowrie bin/bash sh -c 'source /home/cowrie/cowrie/cowrie-env/bin/activate && python -m pip install --upgrade -r requirements.txt'

sudo -u cowrie bin/bash sh -c 'source /home/cowrie/cowrie/cowrie-env/bin/activate && cp /home/rcowrie/cowrie/etc/cowrie.cfg.dist etc/cowrie.cfg'
sudo -u cowrie bin/bash sh -c 'source /home/cowrie/cowrie/cowrie-env/bin/activate && bin/cowrie start'

