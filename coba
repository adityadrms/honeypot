#!/bin/bash

# Cowrie Installation and Running Script

# Update system
echo "Updating system..."
sudo apt update -y
sudo apt install iptables -y

# Install dependencies
echo "Installing dependencies..."
sudo apt install -y git python3-venv libssl-dev libffi-dev build-essential libpython3-dev python3-minimal authbind

# Create a dedicated user for Cowrie
echo "Creating cowrie user..."
sudo adduser --disabled-password --gecos "" cowrie

# Switch to the cowrie user and set up Cowrie
echo "Setting up Cowrie environment..."
sudo -u cowrie -H bash -c 'cd ~ && git clone https://github.com/cowrie/cowrie'

# Create virtual environment and install dependencies
sudo -u cowrie -H bash << 'EOF'
cd ~/cowrie
python3 -m venv cowrie-env
source cowrie-env/bin/activate
pip install --upgrade pip
pip install -r requirements.txt
cp etc/cowrie.cfg.dist etc/cowrie.cfg
EOF

# Start Cowrie
echo "Starting Cowrie..."
bin/cowrie start
EOF

# Show running Cowrie processes
echo "Displaying Cowrie processes..."
ps -u cowrie


# Display message indicating completion
echo "Cowrie installation and setup complete. Cowrie is now running."
