#!/bin/bash

# Cowrie Honeypot Automatic Installation Script
# Tested on Ubuntu 20.04 LTS

# Update and upgrade system packages
echo "Updating and upgrading system packages..."
sudo apt update 

# Install necessary dependencies
echo "Installing dependencies..."
sudo apt install -y python3 python3-venv python3-dev python3-pip libssl-dev libffi-dev build-essential git

# Create cowrie user
echo "Creating cowrie user..."
sudo useradd -r -s /bin/bash -d /home/cowrie -m cowrie

# Switch to cowrie user and set up environment
echo "Switching to cowrie user..."
sudo -u cowrie -i <<'EOF'


# Clone the Cowrie repository
echo "Cloning Cowrie repository..."
sudo git clone https://github.com/cowrie/cowrie.git .
cd ~/cowrie

# Set up a Python virtual environment
echo "Setting up Python virtual environment..."
python -m venv cowrie-env
source cowrie-env/bin/activate

# Install Python dependencies for Cowrie
echo "Installing Python dependencies..."
python -m pip install --upgrade pip
python -m pip install --upgrade -r requirements.txt

# Configure Cowrie
echo "Configuring Cowrie..."
cp etc/cowrie.cfg.dist etc/cowrie.cfg
cd ..

EOF

# Enable Cowrie as a service
echo "Setting up Cowrie as a service..."
sudo bin/cowrie start
