#!/bin/bash

# Cowrie Honeypot Automatic Installation Script
# Based on Cowrie Documentation

# Update and upgrade system packages
echo "Updating and upgrading system packages..."
sudo apt update 

# Install necessary dependencies
echo "Installing dependencies..."
sudo apt install -y git python3 python3-venv python3-dev libssl-dev libffi-dev build-essential libmpfr-dev libgmp-dev

# Create cowrie user
echo "Creating cowrie user..."
sudo adduser --disabled-password --gecos "" cowrie

# Switch to cowrie user and set up environment
echo "Switching to cowrie user..."
sudo -u cowrie -i <<'EOF'

# Navigate to home directory
cd ~

# Clone the Cowrie repository
echo "Cloning Cowrie repository..."
git clone https://github.com/cowrie/cowrie

# Navigate to the Cowrie directory
cd cowrie

# Set up a Python virtual environment
echo "Setting up Python virtual environment..."
python -m venv cowrie-env
source cowrie-env/bin/activate

# Upgrade pip
python -m pip install --upgrade pip

# Install Python dependencies for Cowrie
echo "Installing Python dependencies..."
python -m pip install --upgrade -r requirements.txt

# Configure Cowrie
echo "Configuring Cowrie..."
cp etc/cowrie.cfg.dist etc/cowrie.cfg
bin/cowrie start

