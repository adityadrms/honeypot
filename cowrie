#!/bin/bash


# Step 1: Install system dependencies
sudo apt-get update
sudo apt-get install -y git python3-virtualenv libssl-dev libffi-dev build-essential libpython3-dev python3-minimal authbind
sudo apt-get install -y iptables

# Step 2: Create a dedicated non-root user for Cowrie
sudo adduser --disabled-password --gecos "" cowrie

# Step 3: Switch to the cowrie user
sudo -u cowrie 

# Step 4: Checkout the Cowrie code
sudo git clone http://github.com/cowrie/cowrie && cd cowrie

# Step 5: Setup the Python virtual environment
python -m venv cowrie-env
source cowrie-env/bin/activate

# Upgrade pip and install the required Python packages
python -m pip install --upgrade pip && python -m pip install --upgrade -r requirements.txt

# Step 6: Install configuration file
cp etc/cowrie.cfg.dist etc/cowrie.cfg

# Step 7: Starting Cowrie (initial run to check setup)
bin/cowrie start

